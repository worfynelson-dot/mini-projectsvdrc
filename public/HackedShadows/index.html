<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DEAD_OS // Investigation Unit</title>
<style>
  :root { --accent: #00ff41; --bg: #121212; --glass: rgba(20,20,20,0.85); }
  * { box-sizing: border-box; user-select: none; cursor: default; }
  body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; color: #eee; }
  
  /* WALLPAPER & FX */
  #desktop {
    width: 100vw; height: 100vh; position: relative;
    background: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=1920&auto=format&fit=crop') no-repeat center center/cover;
    transition: filter 0.5s;
  }
  #desktop::after {
    content:''; position:absolute; top:0; left:0; width:100%; height:100%;
    background: radial-gradient(circle, transparent 40%, #000 100%); pointer-events: none;
  }
  .glitch-fx { animation: glitch 0.2s infinite; filter: hue-rotate(90deg); }
  @keyframes glitch { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(2px, -2px); } 60% { transform: translate(0); } }

  /* ICONS */
  .icon-grid { padding: 20px; display: flex; flex-direction: column; flex-wrap: wrap; height: 90vh; align-content: flex-start; gap: 15px; z-index: 10; position: relative; }
  .icon {
    width: 80px; text-align: center; padding: 10px; border-radius: 5px; transition: 0.2s;
    text-shadow: 0 2px 5px rgba(0,0,0,0.8); cursor: pointer;
  }
  .icon:hover { background: rgba(255,255,255,0.1); }
  .icon div { font-size: 36px; margin-bottom: 5px; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); }
  .icon span { font-size: 13px; font-weight: 500; }

  /* WINDOWS */
  .window {
    position: absolute; background: var(--glass); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; box-shadow: 0 20px 50px rgba(0,0,0,0.8);
    display: flex; flex-direction: column; overflow: hidden; min-width: 300px; min-height: 200px;
    animation: openWin 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
  }
  @keyframes openWin { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  
  .title-bar {
    height: 32px; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: space-between;
    padding: 0 12px; cursor: grab; border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .title-bar:active { cursor: grabbing; }
  .controls { display: flex; gap: 8px; }
  .dot { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }
  .cls { background: #ff5f57; } .min { background: #febc2e; } .max { background: #28c840; }
  
  .content { flex: 1; overflow: auto; padding: 0; position: relative; }
  
  /* TASKBAR */
  #taskbar {
    position: absolute; bottom: 0; width: 100%; height: 48px; background: rgba(10,10,10,0.85);
    backdrop-filter: blur(20px); display: flex; align-items: center; padding: 0 15px; border-top: 1px solid rgba(255,255,255,0.1); z-index: 999;
  }
  #start { font-size: 22px; margin-right: 20px; transition: 0.2s; cursor: pointer; filter: grayscale(1); }
  #start:hover { filter: grayscale(0); transform: scale(1.1); }
  .task {
    width: 40px; height: 40px; margin-right: 8px; border-radius: 6px; display: flex; align-items: center; justify-content: center;
    transition: 0.2s; cursor: pointer; position: relative;
  }
  .task:hover { background: rgba(255,255,255,0.1); }
  .task.active { background: rgba(255,255,255,0.15); box-shadow: inset 0 -2px 0 var(--accent); }
  #clock { margin-left: auto; font-size: 12px; font-weight: 600; color: #ccc; }

  /* APP STYLES */
  .term-body { background: #0c0c0c; color: #ccc; font-family: 'Consolas', monospace; padding: 10px; height: 100%; font-size: 14px; }
  .term-input { background: transparent; border: none; color: transparent; width: 1px; height: 1px; }
  .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); padding: 10px; gap: 10px; }
  .file-item { text-align: center; cursor: pointer; padding: 10px; border-radius: 4px; }
  .file-item:hover { background: rgba(255,255,255,0.1); }
  
  /* PHONE EMULATOR */
  .phone-wrap { width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; }
  .phone-header { padding: 10px; background: #222; display: flex; justify-content: space-between; font-size: 12px; }
  .msg-list { flex: 1; padding: 15px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; background: #111; }
  .msg { padding: 8px 12px; border-radius: 15px; max-width: 80%; font-size: 13px; }
  .msg.in { background: #333; align-self: flex-start; border-bottom-left-radius: 2px; }
  .msg.out { background: #005c4b; align-self: flex-end; border-bottom-right-radius: 2px; }
  
  /* START OVERLAY */
  #overlay {
    position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index: 10000;
    display: flex; align-items: center; justify-content: center; flex-direction: column;
  }
  button { padding: 15px 30px; background: var(--accent); border: none; font-weight: bold; font-size: 16px; cursor: pointer; letter-spacing: 2px; }

  @media (max-width: 600px) { .window { width: 96% !important; left: 2% !important; top: 50px !important; height: 80% !important; } }
</style>
</head>
<body>

<div id="overlay">
  <h1 style="color:#fff; letter-spacing:5px;">DEAD_OS</h1>
  <p style="color:#666; margin-bottom:30px;">CASE FILE: #992-AX // NIGHT STALKER</p>
  <button onclick="SYS.boot()">INITIALIZE SYSTEM</button>
</div>

<div id="desktop">
  <div class="icon-grid">
    <div class="icon" onclick="APP.open('pc')"><div>üíª</div><span>This PC</span></div>
    <div class="icon" onclick="APP.open('notes')"><div>üìù</div><span>Case Notes</span></div>
    <div class="icon" onclick="APP.open('terminal')"><div>üìü</div><span>Terminal</span></div>
    <div class="icon" onclick="APP.open('scrcpy')"><div>üì±</div><span>Scrcpy</span></div>
    <div class="icon" onclick="APP.open('browser')"><div>üßÖ</div><span>Tor</span></div>
    <div class="icon" onclick="APP.open('gallery')"><div>üì∑</div><span>Evidence</span></div>
    <div class="icon" onclick="APP.open('trash')"><div>üóëÔ∏è</div><span>Trash</span></div>
    <div class="icon" onclick="APP.open('music')"><div>üéµ</div><span>Ambience</span></div>
  </div>

  <div id="win-layer"></div>

  <div id="taskbar">
    <div id="start">‚ùñ</div>
    <div id="dock" style="display:flex;"></div>
    <div id="clock">00:00</div>
  </div>
</div>

<!-- PART 1: SYSTEM ENGINE (UI, Audio, Window Management) -->
<script>
const SYS = {
  z: 100, wins: [], audio: null, osc: null,
  
  boot: function() {
    document.getElementById('overlay').style.display = 'none';
    this.audio = new (window.AudioContext || window.webkitAudioContext)();
    this.playDrone();
    this.clockLoop();
    // Start Story
    setTimeout(() => APP.open('notes'), 1000);
    // Global Inputs
    window.addEventListener('mouseup', () => this.stopDrag());
    window.addEventListener('touchend', () => this.stopDrag());
    window.addEventListener('mousemove', (e) => this.drag(e));
    window.addEventListener('touchmove', (e) => this.drag(e));
  },

  createWin: function(id, title, html, w=500, h=400) {
    if(document.getElementById('w-'+id)) return this.focus(id);
    const win = document.createElement('div');
    win.className = 'window'; win.id = 'w-'+id;
    win.style.width = w+'px'; win.style.height = h+'px';
    win.style.zIndex = ++this.z;
    // Random spawn pos
    win.style.left = (Math.random()*50 + 50) + 'px';
    win.style.top = (Math.random()*50 + 50) + 'px';
    
    win.innerHTML = `
      <div class="title-bar" onmousedown="SYS.startDrag(event, '${id}')" ontouchstart="SYS.startDrag(event, '${id}')">
        <div style="display:flex;align-items:center;gap:10px;"><span>${title}</span></div>
        <div class="controls">
          <div class="dot min"></div>
          <div class="dot max"></div>
          <div class="dot cls" onclick="SYS.close('${id}')"></div>
        </div>
      </div>
      <div class="content">${html}</div>
    `;
    
    win.onmousedown = () => this.focus(id);
    document.getElementById('win-layer').appendChild(win);
    this.wins.push(id);
    this.addDock(id);
  },

  close: function(id) {
    document.getElementById('w-'+id).remove();
    document.getElementById('t-'+id).remove();
    this.wins = this.wins.filter(x => x !== id);
  },

  focus: function(id) {
    const el = document.getElementById('w-'+id);
    if(el) el.style.zIndex = ++this.z;
    document.querySelectorAll('.task').forEach(t => t.classList.remove('active'));
    const t = document.getElementById('t-'+id);
    if(t) t.classList.add('active');
  },

  addDock: function(id) {
    const d = document.getElementById('dock');
    const t = document.createElement('div');
    t.className = 'task active'; t.id = 't-'+id;
    t.innerText = id[0].toUpperCase();
    t.onclick = () => this.focus(id);
    d.appendChild(t);
  },

  // Drag Logic
  dragEl: null, offX:0, offY:0,
  startDrag: function(e, id) {
    this.dragEl = document.getElementById('w-'+id);
    this.focus(id);
    const c = e.touches ? e.touches[0] : e;
    const r = this.dragEl.getBoundingClientRect();
    this.offX = c.clientX - r.left; this.offY = c.clientY - r.top;
  },
  drag: function(e) {
    if(!this.dragEl) return;
    e.preventDefault();
    const c = e.touches ? e.touches[0] : e;
    this.dragEl.style.left = (c.clientX - this.offX) + 'px';
    this.dragEl.style.top = (c.clientY - this.offY) + 'px';
  },
  stopDrag: function() { this.dragEl = null; },

  clockLoop: function() {
    const d = new Date();
    document.getElementById('clock').innerText = d.getHours()+':'+(d.getMinutes()<10?'0':'')+d.getMinutes();
    setTimeout(() => this.clockLoop(), 1000);
  },

  // Procedural Horror Audio
  playDrone: function() {
    if(!this.audio) return;
    const o = this.audio.createOscillator();
    const g = this.audio.createGain();
    o.type = 'sawtooth'; o.frequency.value = 50;
    // Lowpass filter for "muffled" sound
    const f = this.audio.createBiquadFilter();
    f.type = 'lowpass'; f.frequency.value = 100;
    
    o.connect(f); f.connect(g); g.connect(this.audio.destination);
    g.gain.value = 0.15;
    o.start();
    this.osc = o; // Keep ref to stop
  },
  
  sfx: function(type) {
    if(!this.audio) return;
    const o = this.audio.createOscillator();
    const g = this.audio.createGain();
    o.connect(g); g.connect(this.audio.destination);
    if(type=='err') { o.type='sawtooth'; o.frequency.value=150; g.gain.exponentialRampToValueAtTime(0.01, this.audio.currentTime+0.3); }
    if(type=='scare') { o.type='square'; o.frequency.value=600; o.frequency.linearRampToValueAtTime(100, this.audio.currentTime+0.5); g.gain.value=0.5; }
    o.start(); o.stop(this.audio.currentTime + (type=='scare'?0.5:0.3));
  }
};
</script>

<!-- PART 2: GAMEPLAY LOGIC & APPS -->
<script>
const GAME = {
  stage: 0,
  password: 'death', // The answer to the puzzle
  phoneUnlocked: false,
  gps: false
};

const APP = {
  open: function(name) {
    switch(name) {
      case 'notes':
        SYS.createWin('notes', 'Case #992 Notes', `
          <div style="padding:15px; color:#ddd; line-height:1.6;">
            <h3>Target: The Night Stalker</h3>
            <p>1. Victim's laptop secured. Need to find where he hid the body.</p>
            <p>2. Phone is locked. I need to use <b>Terminal</b> to force a connection.</p>
            <p>3. Password hint is somewhere in the <b>Trash</b> bin.</p>
            <hr>
            <p style="color:red">WARNING: He is watching the network.</p>
          </div>
        `);
        break;
        
      case 'trash':
        SYS.createWin('trash', 'Recycle Bin', `
          <div class="file-grid">
            <div class="file-item"><div>üìÑ</div>scan.pdf</div>
            <div class="file-item" onclick="alert('File Corrupted')"><div>‚ö†Ô∏è</div>virus.exe</div>
            <div class="file-item" onclick="APP.showHint()"><div>üìù</div>pass_hint.txt</div>
          </div>
        `);
        break;

      case 'pc':
        SYS.createWin('pc', 'This PC', `
          <div class="file-grid">
            <div class="file-item"><div>üíæ</div>Local (C:)</div>
            <div class="file-item" onclick="APP.open('gallery')"><div>üìÅ</div>Pictures</div>
            <div class="file-item"><div>üìÅ</div>System</div>
          </div>
        `);
        break;

      case 'gallery':
        SYS.createWin('gallery', 'Evidence Viewer', `
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px; padding:10px;">
            <div style="background:#222; height:100px; display:flex; align-items:center; justify-content:center;">No Signal</div>
            <div style="background:#333; height:100px;"></div>
            <div style="background:#111; grid-column:span 2; height:150px; display:flex; align-items:center; justify-content:center; color:#555;">
              ${GAME.gps ? '<img src="https://maps.googleapis.com/maps/api/staticmap?center=40.714728,-73.998672&zoom=12&size=400x150&sensor=false&key=YOUR_KEY_HERE" alt="Lat: 66.6, Lon: 66.6" style="width:100%; opacity:0.6">' : 'MAP DATA MISSING'}
            </div>
          </div>
        `);
        break;

      case 'terminal':
        SYS.createWin('terminal', 'CMD.exe (Administrator)', `
          <div class="term-body" onclick="document.getElementById('in').focus()">
            <div>Microsoft Windows [Version 10.0.19045]<br>(c) Microsoft Corporation.<br><br>Type 'help' for commands.</div>
            <div id="out"></div>
            <div style="display:flex;">
              <span>C:\\Users\\Admin&gt;&nbsp;</span>
              <span id="txt"></span>
              <span style="animation:glitch 1s infinite">_</span>
            </div>
            <input id="in" class="term-input" oninput="APP.termType(this)" onkeydown="APP.termEnter(event)">
          </div>
        `, 600, 350);
        break;

      case 'scrcpy':
        let content = GAME.phoneUnlocked ? `
          <div class="phone-wrap">
            <div class="phone-header"><span>LTE</span><span>11:34 PM</span></div>
            <div class="msg-list">
              <div class="msg in">The job is done.</div>
              <div class="msg out">Did you clean up?</div>
              <div class="msg in">Yeah. I buried it at the old mill.</div>
              <div class="msg in">Coords sent to secure server.</div>
              <div class="msg out" style="background:#555; cursor:pointer;" onclick="APP.foundGPS()">
                <div>üìç <b>Shared Location</b></div>
                <div style="font-size:10px; opacity:0.7">Click to download</div>
              </div>
            </div>
            <div style="padding:15px; background:#222; text-align:center;">Type message...</div>
          </div>
        ` : `
          <div style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#000; color:red;">
            <div style="font-size:40px;">üîí</div>
            <h3>DEVICE LOCKED</h3>
            <p>ADB Debugging Unauthorized</p>
            <p style="color:#666">Use Terminal to bridge connection.</p>
          </div>
        `;
        SYS.createWin('scrcpy', 'Pixel 6 - Scrcpy', content, 320, 580);
        break;

      case 'browser':
        SYS.createWin('browser', 'Tor Browser', `
          <div style="background:#333; padding:5px; color:#fff; font-size:12px;">URL: http://hidden-service.onion</div>
          <div style="padding:20px; color:#ccc;">
            <h1>Dark Net Search</h1>
            ${GAME.gps ? '<h2 style="color:red">LOCATION CONFIRMED: THE OLD MILL</h2><p>Dispatching units...</p>' : '<p>Waiting for GPS coordinates...</p>'}
          </div>
        `);
        break;
        
      case 'music':
        SYS.createWin('music', 'Media Player', `
          <div style="text-align:center; padding:20px;">
            <h3>Ambient_Track_01.mp3</h3>
            <div style="height:4px; background:#333; margin:20px 0;"><div style="width:30%; height:100%; background:var(--accent);"></div></div>
            <button onclick="SYS.playDrone()">‚ñ∂ PLAY</button>
            <button onclick="if(SYS.osc) SYS.osc.stop()">‚èπ STOP</button>
          </div>
        `, 300, 200);
        break;
    }
  },

  // GAME EVENTS
  showHint: function() {
    alert("pass_hint.txt: \n\n'The password is what comes for us all.'\n(5 letters, lowercase)");
  },

  foundGPS: function() {
    GAME.gps = true;
    SYS.sfx('scare'); // Reward sound
    alert("DOWNLOADING GPS DATA...");
    setTimeout(() => {
      alert("DOWNLOAD COMPLETE.\nCheck 'Evidence' or 'Browser'.");
      APP.triggerHorror();
    }, 1500);
  },

  triggerHorror: function() {
    // Endgame visuals
    document.getElementById('desktop').style.filter = "hue-rotate(90deg) contrast(150%)";
    SYS.sfx('scare');
    setTimeout(() => alert("THEY KNOW YOU ARE HERE."), 2000);
  },

  // TERMINAL LOGIC
  cmdHistory: [],
  termType: function(el) {
    document.getElementById('txt').innerText = el.value;
  },
  termEnter: function(e) {
    if(e.key !== 'Enter') return;
    const val = e.target.value.toLowerCase().trim();
    const out = document.getElementById('out');
    out.innerHTML += `<div>C:\\Users\\Admin> ${val}</div>`;
    e.target.value = ''; document.getElementById('txt').innerText = '';

    if(val === 'help') {
      out.innerHTML += `<div style="color:#aaa">COMMANDS: help, dir, adb connect, exit</div>`;
    } 
    else if(val === 'dir') {
       out.innerHTML += `<div>log.txt<br>system32<br>personal</div>`;
    }
    else if(val === 'adb connect') {
      out.innerHTML += `<div style="color:yellow">Input Admin Password:</div>`;
      GAME.awaitingPass = true;
    }
    else if(GAME.awaitingPass) {
      if(val === GAME.password) {
        out.innerHTML += `<div style="color:#0f0">ACCESS GRANTED.<br>Bridge established.</div>`;
        GAME.phoneUnlocked = true;
        GAME.awaitingPass = false;
        SYS.sfx('scare'); // Positive feedback sound actually
        setTimeout(() => {
            SYS.close('scrcpy');
            APP.open('scrcpy'); // Reload app
        }, 1000);
      } else {
        out.innerHTML += `<div style="color:red">ACCESS DENIED.</div>`;
        SYS.sfx('err');
      }
    }
    else {
      out.innerHTML += `<div style="color:red">Bad command or file name.</div>`;
    }
  }
};
</script>
</body>
</html>
